input {
  tcp {
    port => 5000
    codec => json
  }
  
  udp {
    port => 5000
    codec => json
  }
}

filter {
  # Adicionar timestamp se não existir
  if ![timestamp] {
    mutate {
      add_field => { "timestamp" => "%{@timestamp}" }
    }
  }
  
  # Adicionar tags baseado no nível de log
  if [level] == "Error" or [level] == "Fatal" {
    mutate {
      add_tag => ["error"]
    }
  }
  
  if [level] == "Warning" {
    mutate {
      add_tag => ["warning"]
    }
  }
  
  # Extrair informações do correlation ID
  if [correlationId] {
    mutate {
      add_field => { "trace_id" => "%{correlationId}" }
    }
  }
}

output {
  elasticsearch {
    hosts => ["elasticsearch:9200"]
    index => "monitoring-logs-%{+YYYY.MM.dd}"
    
    # Template para índice
    template_name => "monitoring-logs"
    template_overwrite => true
  }
  
  # Output para debug (opcional)
  stdout {
    codec => rubydebug
  }
}
